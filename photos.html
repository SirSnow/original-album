<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true">
    <meta name="x5-fullscreen" content="true">
    <meta name="360-fullscreen" content="true">
    <meta name="screen-orientation" content="portrait">
    <meta http-equiv="expires" content="0">
    <title>原画册</title>

    <!--引用样式部分-->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/reset.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">

    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <!--<script src="js/iscroll.js"></script>-->

</head>
<body>
<div class="nav-header">
    <!--一般显示用的banner-->
    <div class="nav-pc nav-pc-follow none-display" >
        <ul class="list-follow">
            <li class="list-follow-item weixin-follow"><a href=""></a></li>
            <li class="list-follow-item weibo-follow"><a href="https://weibo.com/originalalbum"></a></li>
            <li class="list-follow-item zhihu-follow"><a href="https://www.zhihu.com/people/oalbum/answers"></a></li>
            <li class="list-follow-item lofter-follow"><a href="http://o-album.lofter.com/"></a></li>
        </ul>
        <div class="nav-copyright">copy right © 原画册</div>
        <div class="follow-close-btn" id="follow-close"><img src="img/cross.png"></div>
    </div>

    <div class="nav-pc">
        <div class="nav-pc_logo"><a href="index.html"></a></div>
        <ul class="list-nav">
            <li class="list-nav-item"><a href="photos.html">PHOTO</a></li>
            <li class="list-nav-item"><a href="design.html">DESIGN</a></li>
            <li class="list-nav-item"><a href="events.html">EVENT</a></li>
            <li class="list-nav-item"><a href="team.html">TEAM</a></li>
            <li class="list-nav-item"><a href="contact.html">CONTACT</a></li>
        </ul>
        <div class="nav-btn"><div class="nav-btn-text" id="follow-open">FOLLOW US</div></div>
    </div>
    <div class="nav-pc nav-search">
        <div class="nav-main_inner">
            <ul class="listSelect only-pc">
                <div id="listTag" class="listSelectItem">全部标签</div>
                <div class="overlay overlay-filter-tag">
                    <ul class="list-filter" data-filter-group="tag">
                        <li id="tagAll" data-value="全部标签" data-filter="" class="list-filter-item tag-item">全部标签</li>
                        <li id="tagHoner" data-value="获奖作品" data-filter=".获奖作品" class="list-filter-item tag-item">获奖作品</li>
                        <li id="tagSpace" data-value="场所标本" data-filter=".场所标本" class="list-filter-item tag-item">场所标本</li>
                        <li id="tagSym" data-value="对等空间" data-filter=".对等空间" class="list-filter-item tag-item">对等空间</li>
                        <li id="tagPair" data-value="二人世界" data-filter=".二人世界" class="list-filter-item tag-item">二人世界</li>
                        <li id="tagChild" data-value="儿童" data-filter=".儿童" class="list-filter-item tag-item">儿童</li>
                        <li id="tagPort" data-value="人文" data-filter=".人文" class="list-filter-item tag-item">人文</li>
                        <li id="tagArchi" data-value="建筑" data-filter=".建筑" class="list-filter-item tag-item">建筑</li>
                        <li id="tagGeo" data-value="几何" data-filter=".几何" class="list-filter-item tag-item">几何</li>

                    </ul>
                </div>
                <div id="listYear" class="listSelectItem">全部年份</div>
                <div class="overlay overlay-filter-year">
                    <ul class="list-filter" data-filter-group="year">
                        <li id="yearAll" data-value="全部年份" data-filter="" class="list-filter-item year-item">全部年份</li>
                        <li id="year2016" data-value="2016" data-filter=".2016" class="list-filter-item year-item">2016</li>
                        <li id="year2015" data-value="2015" data-filter=".2015" class="list-filter-item year-item">2015</li>
                        <li id="year2013" data-value="2013" data-filter=".2013" class="list-filter-item year-item">2013</li>
                    </ul>
                </div>
            </ul>
        </div>
    </div>

</div>

<div class="main-pc list-work">
    <ul class="list-btn">
        <li><a href="#">#<span class="Result">0</span>个结果#</a></li>
    </ul>
    <ul class="list-event resultItem">


    </ul>

    <div class="loading">
        <svg id="load" x="0px" y="0px" viewBox="0 0 150 150"> <circle id="loading-inner" cx="75" cy="75" r="60"/> </svg>
        <div class="main-design">Designed by Assemble</div>
    </div>

    <div id="endHint" style="display:none;margin-top: -14rem;" class="main-design">Completed</div>

</div>

<script src="js/objs.js"></script>
<script src="js/main.js"></script>
<script>
    var card='<li id="card%data1%" class="work-col "><div class="paper paper-work"><img class="card-img" src="%data2%"/><div class="work-title"><h4><span>%data3%</span></h4></div></div></li>';
    var initNum=20;
    var maxNum=photoSet.length;
    var photo_filters = {};

    var ReplaceObj;
    var PhotoEvent=new EventObj(photoSet);
    window.onload=function () {
        PhotoEvent.reset();
//        Reset(photoSet);
    };
    ///////////////////////////////////

    $('.list-filter').on( 'click', '.list-filter-item', function() {
        var $this = $(this);
        // get group key
        var $buttonGroup = $this.parents('.list-filter');
        var filterGroup = $buttonGroup.attr('data-filter-group');
        // set filter for group
        photo_filters[ filterGroup ] = $this.attr('data-filter');
        // combine filters
        var filterValue = '';
        for ( var prop in photo_filters ) {
            filterValue += photo_filters[ prop ];
        }
        console.log(filterValue);
        // set filter for Isotope
        $('.resultItem').isotope({ filter:filterValue});
        var $grid=$('.resultItem').isotope({ filter:filterValue});
        var iso = $grid.data('isotope');
        var num=iso.filteredItems.length;
        $('.Result').text(num);
        if (num<initNum){
            console.log("filter num被调用");
            $('.loading').css("opacity",0);
            scrollDownRefresh(false,null);
        }else{
            scrollDownRefresh(true,photoSet);
        }

//

    });

    ///////////////////////////////////

    function Reset(dataSet){
        $('.Result').text(maxNum);
        $('.work-col').remove();
        $('#endHint').hide();

        if(dataSet[0]!=null){
            for(var j=0;j<=initNum;j++){
                if(dataSet[j]!=null){

                    Replace(j,dataSet[j].ava,dataSet[j].title);
                    for(var m=0;m<dataSet[j].tag.length;m++){
                        $('#card'+j).addClass(dataSet[j].tag[m]);
                    }


                }else{
                    console.log("#load opacity = 0");
                    $('.loading').css("opacity",0);
                }
            }

        }else{
            console.log("#load opacity = 0");
            $('.loading').css("opacity",0);
        }

        PhotoEvent.gotoDetail();

        if (dataSet.length<initNum){
            scrollDownRefresh(false,null);
            console.log("scrollDownRefresh false 调用");
            $('.loading').css("opacity",0);
        }else{
            console.log("scrollDownRefresh true 调用");
            scrollDownRefresh(true,photoSet);
        }
    }


    function Replace(data1,data2,data3){
        $('.resultItem').append(card.replace("%data1%",data1).replace("%data2%",data2).replace("%data3%",data3));
    }

    /*function gotoPhotoDetail() {

        $("[id^=card]").click( function () {
            var id=parseInt($(this).attr("id").split("card")[1]);
            console.log('card'+id);
            localStorage.setItem('photo-title', photoSet[id].title);
            localStorage.setItem('photo-tag', photoSet[id].tag);
            localStorage.setItem('photo-work', photoSet[id].work);
            localStorage.setItem('photo-desc', photoSet[id].desc);
            window.location.href="photos-detail.html";

        });
    }*/

    /////////////////////////////////////////////////////
    function scrollDownRefresh(abled,dataSet){
        var range = 50;             //距下边界长度/单位px
        var pace = 8;
        var totalheight = 0;
//        var index=20;
        if(abled){
            $(window).scroll(function(){
                var srollPos = $(window).scrollTop();
                //滚动条距顶部距离(页面超出窗口的高度)

                console.log("scroll执行了");

                totalheight = parseFloat($(window).height()) + parseFloat(srollPos);


                if(($(document).height()-range) <= totalheight){
                    $('.loading').css("opacity",1);
                    setTimeout(function () {
                        $('.loading').css("opacity",0);
                        if(initNum<maxNum){
                            for(var i=0;i<pace;i++){
                                initNum=initNum+1;
                                if(dataSet[initNum] != null){
                                    console.log('pace:'+initNum);
                                    Replace(initNum,dataSet[initNum].ava,dataSet[initNum].title);
                                    for(var m=0;m<dataSet[initNum].tag.length;m++){
                                        $('#card'+initNum).addClass(dataSet[initNum].tag[m]);
                                    }

                                    PhotoEvent.gotoDetail()
                                }else{
                                    console.log('break tag');
                                    $('.loading').css("opacity",0);
                                    $('#endHint').show();
                                }


                            }
                        }else{
                            console.log('reach bottom');
                            $('.loading').css("opacity",0);
                            $('#endHint').show();
                        }


                    },1000);

                }


            });
        }else{
            console.log("scrollDownRefresh 没有执行");
        }

    }

</script>
</body>
</html>